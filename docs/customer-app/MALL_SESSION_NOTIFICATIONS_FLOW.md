# Mall Session Notifications Flow - Technical Documentation

## Overview

This document provides comprehensive technical documentation for the notification system in the KitchnTabs Mall application. It covers all notification events, recipients, delivery channels, and the interconnected components that make the system work.

---

## Table of Contents

1. [System Architecture](#system-architecture)
2. [Notification Flow Diagram](#notification-flow-diagram)
3. [Notification Events Matrix](#notification-events-matrix)
4. [Component Architecture](#component-architecture)
5. [Detailed Event Flows](#detailed-event-flows)
6. [Delivery Channels](#delivery-channels)
7. [Role-Based Targeting](#role-based-targeting)
8. [Code Component Reference](#code-component-reference)

---

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           MALL SESSION NOTIFICATION SYSTEM                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Customer      â”‚     â”‚   Mall Session  â”‚     â”‚        Notification             â”‚   â”‚
â”‚  â”‚   (Mobile App)  â”‚â”€â”€â”€â”€â–¶â”‚   Controller    â”‚â”€â”€â”€â”€â–¶â”‚        Builder                  â”‚   â”‚
â”‚  â”‚                 â”‚     â”‚                 â”‚     â”‚   AppNotificationBuilder        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚                       â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                          â”‚                                       â”‚                   â”‚  â”‚
â”‚                          â–¼                                       â–¼                   â–¼  â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               â”‚   WebSocket     â”‚                    â”‚    Email     â”‚    â”‚    FCM       â”‚
â”‚               â”‚   (Pusher)      â”‚                    â”‚   (SMTP)     â”‚    â”‚   (Push)     â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                        â”‚                                    â”‚                   â”‚       â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚                   â”‚       â”‚
â”‚         â”‚              â”‚              â”‚                     â”‚                   â”‚       â”‚
â”‚         â–¼              â–¼              â–¼                     â–¼                   â–¼       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Electron   â”‚ â”‚   React     â”‚ â”‚   Python    â”‚    â”‚   Staff     â”‚    â”‚   Mobile    â”‚ â”‚
â”‚  â”‚  Desktop    â”‚ â”‚   Browser   â”‚ â”‚   Service   â”‚    â”‚   Email     â”‚    â”‚   Device    â”‚ â”‚
â”‚  â”‚  (Kitchen)  â”‚ â”‚   (Admin)   â”‚ â”‚   (TTS)     â”‚    â”‚   Inbox     â”‚    â”‚   (FCM)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Notification Flow Diagram

### Mall Session Order Creation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MALL SESSION ORDER CREATION FLOW                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  CUSTOMER                   BACKEND                            RECIPIENTS
  â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€                            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Scan QR  â”‚
  â”‚  Code     â”‚
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚  1. Create Session
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Select Items  â”‚
  â”‚ from Multiple â”‚
  â”‚ Restaurants   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚  2. Submit Order
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  MallTabs     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    NOTIFICATION DISPATCH                    â”‚
  â”‚  Controller   â”‚         â”‚                                                             â”‚
  â”‚  ._create()   â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚  1. CREATE MASTER TAB (Mall Manager Tenant)          â”‚   â”‚
                            â”‚  â”‚     â””â”€â–¶ Socket ONLY (UI refresh)                     â”‚   â”‚
                            â”‚  â”‚         âŒ No Email, âŒ No FCM Push                   â”‚   â”‚
                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                            â”‚                                                             â”‚
                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                            â”‚  â”‚  2. CREATE TENANT TAB (Per Restaurant)               â”‚   â”‚
                            â”‚  â”‚     â””â”€â–¶ MallSessionTabCreationNotification           â”‚   â”‚â”€â”€â”€â”€â–¶ ğŸ”” Staff
                            â”‚  â”‚         âœ… Socket (UI refresh)                       â”‚   â”‚â”€â”€â”€â”€â–¶ ğŸ”” Kitchen
                            â”‚  â”‚         âœ… FCM Push (mobile notification)            â”‚   â”‚
                            â”‚  â”‚         âœ… TTS Speech (Python service)               â”‚   â”‚
                            â”‚  â”‚         âœ… Alarm (frontend sound)                    â”‚   â”‚
                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                            â”‚                                                             â”‚
                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                            â”‚  â”‚  3. TAB STATUS CHANGE (TabChannelNotification)       â”‚   â”‚
                            â”‚  â”‚     CREATED Status:                                  â”‚   â”‚
                            â”‚  â”‚       â€¢ Master Tab: Socket ONLY                      â”‚   â”‚â”€â”€â”€â”€â–¶ âŒ Mall Manager
                            â”‚  â”‚       â€¢ Tenant Tab: Socket + Email                   â”‚   â”‚â”€â”€â”€â”€â–¶ âœ… Store Staff
                            â”‚  â”‚     CONFIRMED Status:                                â”‚   â”‚
                            â”‚  â”‚       â€¢ Tenant Tab: Socket + Email + FCM + TTS       â”‚   â”‚â”€â”€â”€â”€â–¶ âœ… Kitchen
                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                            â”‚                                                             â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Notification Events Matrix

### By Event Type

| Event | Notification Class | Socket | Email | FCM Push | TTS/Speech | Alarm |
|-------|-------------------|--------|-------|----------|------------|-------|
| **Mall Tab Created (Master)** | `MallSessionTabCreationNotification` | âœ… | âŒ | âŒ | âŒ | âŒ |
| **Mall Tab Created (Tenant)** | `MallSessionTabCreationNotification` | âœ… | âŒ | âœ… | âœ… | âœ… |
| **Tab Status: CREATED (Master)** | `TabChannelNotification` | âœ… | âŒ | âŒ | âŒ | âŒ |
| **Tab Status: CREATED (Tenant)** | `TabChannelNotification` | âœ… | âœ… | âŒ | âŒ | âŒ |
| **Tab Status: CONFIRMED (Tenant)** | `TabChannelNotification` | âœ… | âœ… | âœ… | âœ… | âœ… |
| **Tab Status: IN_PREPARATION** | `TabChannelNotification` | âœ… | âŒ | âŒ | âŒ | âŒ |
| **Tab Status: PREPARED** | `TabChannelNotification` | âœ… | âŒ | âŒ | âŒ | âŒ |
| **Tab Status: DELIVERED** | `TabChannelNotification` | âœ… | âŒ | âŒ | âŒ | âŒ |
| **Tab Status: CANCELLED** | `TabChannelNotification` | âœ… | âŒ | âŒ | âŒ | âŒ |
| **Store Assistance Request** | `MallStoreAssistanceNotification` | âœ… | âŒ | âœ… | âœ… | âœ… |

### By Recipient Role

| Role | CREATED (Master) | CREATED (Tenant) | CONFIRMED | Other Status |
|------|------------------|------------------|-----------|--------------|
| **Mall Manager** | Socket only | âŒ | âŒ | âŒ |
| **Staff** | âŒ | Socket + Email | âŒ | Socket only |
| **Kitchen** | âŒ | âŒ | Socket + Email + FCM + TTS | Socket only |
| **Admin** | Socket only | Socket + Email | Socket + Email + FCM | Socket only |

---

## Component Architecture

### Backend Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              BACKEND COMPONENT DIAGRAM                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                            CONTROLLERS LAYER                                     â”‚   â”‚
â”‚   â”‚                                                                                  â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚  â”‚ MallTabsController  â”‚    â”‚ MallSessionControllerâ”‚   â”‚ MallStoresControllerâ”‚   â”‚   â”‚
â”‚   â”‚  â”‚                     â”‚    â”‚                      â”‚   â”‚                     â”‚   â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ _create()         â”‚    â”‚ â€¢ getSessionAuth()   â”‚   â”‚ â€¢ assistance()      â”‚   â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ update()          â”‚    â”‚ â€¢ getNotifications() â”‚   â”‚                     â”‚   â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â”‚             â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                 â”‚                                                                         â”‚
â”‚                 â–¼                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                              TRAITS LAYER                                        â”‚   â”‚
â”‚   â”‚                                                                                  â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚  â”‚                     MallTabHelpersTrait                                   â”‚   â”‚   â”‚
â”‚   â”‚  â”‚                                                                           â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ createMasterTab()     - Creates aggregator tab for mall manager       â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ createTenantTab()     - Creates individual store tabs                  â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ buildProductSummary() - Generates "un Bulgogi, dos Bibimbap" text     â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ groupProductsByTenant() - Splits order by restaurant                   â”‚   â”‚   â”‚
â”‚   â”‚  â”‚                                                                           â”‚   â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â”‚                                                                                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                 â”‚                                                                         â”‚
â”‚                 â–¼                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                            SERVICES LAYER                                        â”‚   â”‚
â”‚   â”‚                                                                                  â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚  â”‚                   TabsNotificationService                                 â”‚   â”‚   â”‚
â”‚   â”‚  â”‚                                                                           â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ handleStatusChange()          - Main entry point for status changes   â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ sendNotification()            - Dispatches TabChannelNotification     â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ enrichNotificationDataWithOrderDetails() - Adds order info for email â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ speechOrderProducts()         - Generates TTS speech text             â”‚   â”‚   â”‚
â”‚   â”‚  â”‚                                                                           â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  KEY LOGIC:                                                               â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ Master tabs ($tab->is_master_tab) â†’ Socket only, NO email             â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ Tenant CREATED â†’ Socket + Email to staff                              â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ Tenant CONFIRMED â†’ Socket + Email + FCM + TTS to kitchen              â”‚   â”‚   â”‚
â”‚   â”‚  â”‚                                                                           â”‚   â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â”‚                                                                                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                 â”‚                                                                         â”‚
â”‚                 â–¼                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                          NOTIFICATIONS LAYER                                     â”‚   â”‚
â”‚   â”‚                                                                                  â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚  â”‚ MallSessionTabCreation     â”‚  â”‚ TabChannelNotification                  â”‚   â”‚   â”‚
â”‚   â”‚  â”‚ Notification               â”‚  â”‚                                          â”‚   â”‚   â”‚
â”‚   â”‚  â”‚                            â”‚  â”‚ Channels:                                â”‚   â”‚   â”‚
â”‚   â”‚  â”‚ Channels:                  â”‚  â”‚ â€¢ socket: true                           â”‚   â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ socket: true             â”‚  â”‚ â€¢ mail: true (conditional)              â”‚   â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ push: true (tenant only) â”‚  â”‚ â€¢ push: true (CONFIRMED only)           â”‚   â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ mail: false              â”‚  â”‚ â€¢ database: true                        â”‚   â”‚   â”‚
â”‚   â”‚  â”‚                            â”‚  â”‚                                          â”‚   â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â”‚                                                                                  â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚  â”‚ MallStoreAssistance        â”‚  â”‚ MallSessionOrderStatus                  â”‚   â”‚   â”‚
â”‚   â”‚  â”‚ Notification               â”‚  â”‚ Notification                            â”‚   â”‚   â”‚
â”‚   â”‚  â”‚                            â”‚  â”‚                                          â”‚   â”‚   â”‚
â”‚   â”‚  â”‚ Channels:                  â”‚  â”‚ (For customer-facing status updates)    â”‚   â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ socket: true             â”‚  â”‚                                          â”‚   â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ push: true               â”‚  â”‚                                          â”‚   â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ mail: false              â”‚  â”‚                                          â”‚   â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â”‚                                                                                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                 â”‚                                                                         â”‚
â”‚                 â–¼                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                      NOTIFICATION BUILDER (Core)                                 â”‚   â”‚
â”‚   â”‚                                                                                  â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚  â”‚                    AppNotificationBuilder::send()                         â”‚   â”‚   â”‚
â”‚   â”‚  â”‚                                                                           â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  Parameters:                                                              â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ notificationClass - Which notification class to use                   â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ channel           - WebSocket channel (e.g., "tenant.2.system")       â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ scope             - "channel" | "private" | "public"                  â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ targets           - ['kitchen', 'staff', 'admin']                     â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ targetType        - "role" | "user"                                   â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ individual        - ["push", "mail"] for per-user delivery            â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ config.channels   - Override notification channels                     â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ data              - Notification payload (tts, alarm, speech, etc.)   â”‚   â”‚   â”‚
â”‚   â”‚  â”‚                                                                           â”‚   â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â”‚                                                                                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Frontend Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              FRONTEND COMPONENT DIAGRAM                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                             ELECTRON DESKTOP APP                                    â”‚ â”‚
â”‚  â”‚                                                                                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚   React Admin App   â”‚    â”‚    Python Service   â”‚    â”‚   WebSocket Client    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚   (KitchnTabs)      â”‚    â”‚    (kt_service.py)  â”‚    â”‚   (LaravelEchoContext)â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                     â”‚    â”‚                     â”‚    â”‚                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ TabsListView     â”‚    â”‚  â€¢ TTS Generation   â”‚    â”‚  â€¢ Pusher/Soketi      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ OrderDetails     â”‚â—€â”€â”€â”€â”‚  â€¢ Alarm Playback   â”‚â—€â”€â”€â”€â”‚  â€¢ Channel Subscribe  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Notifications    â”‚    â”‚  â€¢ Audio Player     â”‚    â”‚  â€¢ Event Handling     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                     â”‚    â”‚                     â”‚    â”‚                        â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                               MOBILE APP (Android/iOS)                              â”‚ â”‚
â”‚  â”‚                                                                                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚ â”‚
â”‚  â”‚  â”‚    Capacitor App    â”‚    â”‚   FCM Service       â”‚                                â”‚ â”‚
â”‚  â”‚  â”‚    (React-Admin)    â”‚    â”‚   (Push Handler)    â”‚                                â”‚ â”‚
â”‚  â”‚  â”‚                     â”‚    â”‚                     â”‚                                â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Native Push      â”‚â—€â”€â”€â”€â”‚  â€¢ Background Push  â”‚                                â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ WebView UI       â”‚    â”‚  â€¢ Notification     â”‚                                â”‚ â”‚
â”‚  â”‚  â”‚                     â”‚    â”‚    Display          â”‚                                â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚ â”‚
â”‚  â”‚                                                                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              MALL CLIENT (Customer PWA)                             â”‚ â”‚
â”‚  â”‚                                                                                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚ â”‚
â”‚  â”‚  â”‚  MallSessionEcho    â”‚    â”‚  MallClientTabsList â”‚                                â”‚ â”‚
â”‚  â”‚  â”‚  Context            â”‚    â”‚                     â”‚                                â”‚ â”‚
â”‚  â”‚  â”‚                     â”‚    â”‚  â€¢ Order Status     â”‚                                â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Status Updates   â”‚â”€â”€â”€â–¶â”‚  â€¢ Progress Bars    â”‚                                â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ WebSocket Events â”‚    â”‚  â€¢ Notifications    â”‚                                â”‚ â”‚
â”‚  â”‚  â”‚                     â”‚    â”‚                     â”‚                                â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚ â”‚
â”‚  â”‚                                                                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Detailed Event Flows

### Flow 1: Customer Creates Mall Order

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FLOW 1: CUSTOMER CREATES MALL ORDER                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  STEP 1: Customer submits order with items from Restaurant A and Restaurant B
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Customer App                    MallTabsController._create()
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       â”‚
       â”‚  POST /api/public/mall/tab
       â”‚  {
       â”‚    products: [...],
       â”‚    customer_name: "Francisco",
       â”‚    table_number: "8"
       â”‚  }
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                         BACKEND PROCESSING                               â”‚
  â”‚                                                                          â”‚
  â”‚  1. groupProductsByTenant()                                              â”‚
  â”‚     â””â”€â–¶ Products split: Restaurant A (2 items), Restaurant B (1 item)   â”‚
  â”‚                                                                          â”‚
  â”‚  2. createMasterTab() - Mall Manager Tenant                              â”‚
  â”‚     â”œâ”€â–¶ Tab created: is_master_tab = true                               â”‚
  â”‚     â”œâ”€â–¶ Order created with ALL products (aggregated)                    â”‚
  â”‚     â”‚                                                                    â”‚
  â”‚     â””â”€â–¶ NOTIFICATION: MallSessionTabCreationNotification                â”‚
  â”‚         â”œâ”€ Channel: tenant.{mall_manager_id}.system                     â”‚
  â”‚         â”œâ”€ Socket: âœ… (UI refresh only)                                 â”‚
  â”‚         â”œâ”€ Email: âŒ                                                     â”‚
  â”‚         â”œâ”€ FCM Push: âŒ                                                  â”‚
  â”‚         â”œâ”€ TTS: âŒ (tts='false')                                        â”‚
  â”‚         â””â”€ Targets: ['kitchen', 'staff']                                â”‚
  â”‚                                                                          â”‚
  â”‚  3. createTenantTab() - Restaurant A                                     â”‚
  â”‚     â”œâ”€â–¶ Tab created: master_tab_id = {master_tab.id}                    â”‚
  â”‚     â”œâ”€â–¶ Order created with Restaurant A products only                   â”‚
  â”‚     â”œâ”€â–¶ buildProductSummary() â†’ "un Bulgogi, dos Bibimbap"              â”‚
  â”‚     â”‚                                                                    â”‚
  â”‚     â””â”€â–¶ NOTIFICATION: MallSessionTabCreationNotification                â”‚
  â”‚         â”œâ”€ Channel: tenant.{restaurant_a_id}.system                     â”‚
  â”‚         â”œâ”€ Socket: âœ…                                                    â”‚
  â”‚         â”œâ”€ Email: âŒ                                                     â”‚
  â”‚         â”œâ”€ FCM Push: âœ… individual: ["push"]                            â”‚
  â”‚         â”œâ”€ TTS: âœ… (tts='true', speech='Nuevo pedido...')               â”‚
  â”‚         â”œâ”€ Alarm: âœ… (alarm='true')                                     â”‚
  â”‚         â”œâ”€ Targets: ['kitchen', 'staff']                                â”‚
  â”‚         â”œâ”€ Title: "Nuevo pedido en la mesa 8"                           â”‚
  â”‚         â””â”€ Message: "Francisco: un Bulgogi, dos Bibimbap"               â”‚
  â”‚                                                                          â”‚
  â”‚  4. createTenantTab() - Restaurant B                                     â”‚
  â”‚     â””â”€â–¶ (Same as Restaurant A, different tenant channel)                â”‚
  â”‚                                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  STEP 2: Tab Status Change triggers TabChannelNotification
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                    TabsNotificationService.handleStatusChange()          â”‚
  â”‚                                                                          â”‚
  â”‚  For each tab (master + tenant tabs):                                    â”‚
  â”‚                                                                          â”‚
  â”‚  MASTER TAB (is_master_tab = true):                                      â”‚
  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
  â”‚  â€¢ Status: CREATED                                                       â”‚
  â”‚  â€¢ Channels: socket=âœ…, mail=âŒ, push=âŒ                                  â”‚
  â”‚  â€¢ Recipients: None (socket only for UI)                                 â”‚
  â”‚  â€¢ Reason: Master tabs are aggregators, not operational orders           â”‚
  â”‚                                                                          â”‚
  â”‚  TENANT TAB (is_master_tab = false):                                     â”‚
  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
  â”‚  â€¢ Status: CREATED                                                       â”‚
  â”‚  â€¢ Channels: socket=âœ…, mail=âœ…, push=âŒ                                  â”‚
  â”‚  â€¢ Recipients: staff (for CREATED status)                                â”‚
  â”‚  â€¢ Email includes: order_items, customer info, tenant logo               â”‚
  â”‚                                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flow 2: Staff Confirms Order

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          FLOW 2: STAFF CONFIRMS ORDER                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Staff Dashboard                 TabsController.updateStatus()
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       â”‚
       â”‚  PUT /api/tabs/{id}
       â”‚  { status: "CONFIRMED" }
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                    TabsNotificationService.handleStatusChange()          â”‚
  â”‚                                                                          â”‚
  â”‚  TENANT TAB - Status: CREATED â†’ CONFIRMED                                â”‚
  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                â”‚
  â”‚                                                                          â”‚
  â”‚  1. Update tab.status = 'CONFIRMED'                                      â”‚
  â”‚  2. Update tab.date_confirmed = now()                                    â”‚
  â”‚  3. Update associated order status                                       â”‚
  â”‚  4. If has master_tab_id â†’ update master order products                  â”‚
  â”‚                                                                          â”‚
  â”‚  5. NOTIFICATION: TabChannelNotification                                 â”‚
  â”‚     â”œâ”€ Channel: tenant.{tenant_id}.system                               â”‚
  â”‚     â”œâ”€ Socket: âœ…                                                        â”‚
  â”‚     â”œâ”€ Email: âœ… (full order details with tenant logo)                  â”‚
  â”‚     â”œâ”€ FCM Push: âœ… individual: ["push", "mail"]                        â”‚
  â”‚     â”œâ”€ TTS: âœ… (tts='true', tts_delay=10)                               â”‚
  â”‚     â”œâ”€ Alarm: âœ… (alarm='true')                                         â”‚
  â”‚     â”œâ”€ Targets: ['kitchen'] (CONFIRMED â†’ kitchen only for mall orders)  â”‚
  â”‚     â”œâ”€ Title: "[RESTAURANT] Orden Confirmada"                           â”‚
  â”‚     â””â”€ Message: Speech text with order items                            â”‚
  â”‚                                                                          â”‚
  â”‚  6. Recipients receive:                                                  â”‚
  â”‚     â€¢ Kitchen staff: FCM push + Email + TTS speech                      â”‚
  â”‚     â€¢ Desktop app: WebSocket + Alarm sound + TTS                        â”‚
  â”‚                                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Delivery Channels

### Channel Details

| Channel | Technology | Use Case | Backend Component |
|---------|------------|----------|-------------------|
| **Socket** | Pusher/Soketi WebSocket | Real-time UI updates | `AppNotification` event broadcast |
| **Email** | SMTP (Laravel Mail) | Order confirmations, receipts | `toMail()` method in notification |
| **FCM Push** | Firebase Cloud Messaging | Mobile app background notifications | `toFcm()` method via `individual: ["push"]` |
| **TTS/Speech** | Python `gTTS` service | Voice announcements in kitchen | WebSocket â†’ Python â†’ Audio playback |
| **Database** | MySQL `notifications` table | Notification history, user inbox | `toDatabase()` method |

### Channel Configuration in Code

```php
// Notification class static config
public static function config()
{
    return [
        "name"     => TabChannelNotification::class,
        "active"   => true,
        "channels" => [
            "socket"   => true,   // WebSocket broadcast
            "mail"     => true,   // Email delivery
            "database" => true,   // Store in notifications table
            "push"     => true,   // FCM push (requires individual: ["push"])
        ],
        "mailView" => "notifications.tab_order",
    ];
}

// Per-send override in AppNotificationBuilder
AppNotificationBuilder::send(
    config: [
        'channels' => [
            "socket"   => true,
            "mail"     => false,  // Disable email for this send
            "database" => false,
            "push"     => true,
        ],
    ],
    individual: ["push"],  // Enable per-user FCM delivery
);
```

---

## Role-Based Targeting

### Role Definitions

| Role | Description | Typical Users |
|------|-------------|---------------|
| **admin** | Full system access | Restaurant owner, manager |
| **staff** | Front-of-house staff | Waiters, cashiers |
| **kitchen** | Kitchen staff | Cooks, kitchen manager |

### Targeting Rules for Mall Orders

```php
// In TabsNotificationService::sendNotification()

$isMallOrder = !empty($tab->mall_id) || !empty($tab->master_tab_id);

if ($isMallOrder && isset($data['new'])) {
    if ($data['new'] === Tab::STATUS_CREATED) {
        $targets = ['staff'];  // Staff receives CREATED notifications
    } elseif ($data['new'] === Tab::STATUS_CONFIRMED) {
        $targets = ['kitchen'];  // Kitchen receives CONFIRMED notifications
    }
} else {
    $targets = ['kitchen', 'staff', 'admin'];  // Regular orders: all roles
}
```

### Targeting Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ROLE-BASED TARGETING FLOW                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   Order Type        Status           Target Roles        Delivery            â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€            â”‚
â”‚                                                                              â”‚
â”‚   Mall Order        CREATED    â”€â”€â”€â–¶  ['staff']     â”€â”€â”€â–¶  Socket + Email     â”‚
â”‚   (tenant tab)                                                               â”‚
â”‚                                                                              â”‚
â”‚   Mall Order        CONFIRMED  â”€â”€â”€â–¶  ['kitchen']   â”€â”€â”€â–¶  Socket + Email +   â”‚
â”‚   (tenant tab)                                           FCM + TTS          â”‚
â”‚                                                                              â”‚
â”‚   Mall Order        Other      â”€â”€â”€â–¶  ['kitchen',   â”€â”€â”€â–¶  Socket only        â”‚
â”‚   (master tab)      Status          'staff']                                â”‚
â”‚                                                                              â”‚
â”‚   Regular Order     Any        â”€â”€â”€â–¶  ['kitchen',   â”€â”€â”€â–¶  Per status config  â”‚
â”‚                                       'staff',                               â”‚
â”‚                                       'admin']                               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Code Component Reference

### File Locations

| Component | Path |
|-----------|------|
| **MallTabsController** | `domain/app/Http/Controllers/API/Mall/MallTabs/MallTabsController.php` |
| **MallTabHelpersTrait** | `domain/app/Traits/Mall/MallTabHelpersTrait.php` |
| **TabsNotificationService** | `domain/app/Services/Tabs/TabsNotificationService.php` |
| **MallSessionTabCreationNotification** | `domain/app/Notifications/MallSessionTabCreationNotification.php` |
| **TabChannelNotification** | `domain/app/Notifications/Tab/TabChannelNotification.php` |
| **MallStoreAssistanceNotification** | `domain/app/Notifications/Mall/MallStoreAssistanceNotification.php` |
| **AppNotificationBuilder** | `app/AppNotifications/AppNotificationBuilder.php` |
| **Python TTS Service** | `dash-python-service/src/kt_service.py` |
| **Frontend Echo Context** | `packages/dash-admin/src/contexts/com/LaravelEchoContext.tsx` |

### Key Methods

#### MallTabHelpersTrait

```php
/**
 * Creates master tab (aggregator) for mall manager
 * - Socket only notification (no email, no FCM)
 * - TTS disabled
 */
private function createMasterTab(...): Tab

/**
 * Creates tenant tab for individual restaurant
 * - FCM push + TTS + Alarm enabled
 * - Includes product summary in message
 */
private function createTenantTab(...): Tab

/**
 * Generates "un Bulgogi, dos Bibimbap" text
 */
private function buildProductSummary(array $products): string
```

#### TabsNotificationService

```php
/**
 * Main entry point for status change notifications
 * - Validates transition
 * - Updates tab and order status
 * - Dispatches appropriate notification
 */
public function handleStatusChange(Tab $tab, string $newStatus, bool $silent = false): Tab

/**
 * Determines channels and targets based on:
 * - Tab type (master vs tenant)
 * - Status (CREATED, CONFIRMED, etc.)
 * - Marketplace type (Uber vs others)
 */
private function sendNotification(Tab $tab, array $data, ...): void
```

---

## Summary: Email Recipients by Scenario

### Single Mall Session Order (Customer orders from 1 restaurant)

| Email | Recipient | When | Content |
|-------|-----------|------|---------|
| âŒ | Mall Manager | - | No email (master tab) |
| âœ… | Store Staff | CREATED | Order received |
| âœ… | Store Kitchen | CONFIRMED | Order confirmed, ready to prepare |

### Multi-Restaurant Mall Session Order (Customer orders from 2 restaurants)

| Email | Recipient | When | Content |
|-------|-----------|------|---------|
| âŒ | Mall Manager | - | No email (master tab) |
| âœ… | Restaurant A Staff | CREATED | Restaurant A items |
| âœ… | Restaurant A Kitchen | CONFIRMED | Restaurant A items |
| âœ… | Restaurant B Staff | CREATED | Restaurant B items |
| âœ… | Restaurant B Kitchen | CONFIRMED | Restaurant B items |

---

## Troubleshooting

### Common Issues

1. **Mall manager receiving emails**: Check `is_master_tab` field on tab
2. **Missing FCM notifications**: Ensure `individual: ["push"]` is set
3. **TTS not playing**: Check `tts` flag is `'true'` (string, not boolean)
4. **Duplicate notifications**: Check for multiple notification sends in code path

### Debug Logging

```php
// Enable notifications channel logging
Log::channel('notifications')->info("...", $data);

// Check Laravel logs
tail -f storage/logs/laravel.log | grep -i notification
```

---

*Last Updated: December 2025*
*Version: 1.0*
